<span class="fas fa-circle-notch fa-spin" ng-show="!document && isEdit()"></span>

<div ng-show="document || !isEdit()">
  <form name="documentForm" class="form-horizontal">
    <div class="pull-right btn-group" ng-init="form = documentForm">
      <button type="submit" class="btn btn-primary" ng-disabled="!documentForm.$valid || fileIsUploading" ng-click="edit()">
        <span class="fas fa-save"></span>
        {{ 'save' | translate }}
      </button>
    </div>
    <h1 class="page-header">{{ document.title }}&nbsp;</h1>

    <div uib-alert ng-class="'alert-' + alert.type" ng-repeat="alert in alerts" type="alert.type" close="closeAlert($index)">{{ alert.msg }}</div>

    <div class="row" ng-show="fileIsUploading">
      <h4>{{ 'document.edit.uploading_files' | translate }}</h4>
      <div class="col-md-6"><uib-progressbar value="fileProgress" class="progress-info active"></uib-progressbar></div>
    </div>

    <fieldset>
      <legend>{{ 'document.edit.primary_metadata' | translate }}</legend>
      <div class="form-group" ng-class="{ 'has-error': !documentForm.title.$valid && documentForm.$dirty }">
        <label class="col-sm-2 control-label" for="inputTitle">{{ 'document.title' | translate }}</label>
        <div class="col-sm-10">
          <input required ng-maxlength="100" class="form-control" type="text" id="inputTitle"
            ng-attr-placeholder="{{ 'document.edit.title_placeholder' | translate }}" name="title" ng-model="document.title" autocomplete="off"
            uib-typeahead="document for document in getTitleTypeahead($viewValue)"
            typeahead-wait-ms="200" ng-disabled="fileIsUploading" />
        </div>
      </div>
      <div class="form-group" ng-class="{ 'has-error': !documentForm.description.$valid }">
        <label class="col-sm-2 control-label" for="inputDescription">{{ 'document.description' | translate }}</label>
        <div class="col-sm-10">
          <textarea ng-maxlength="4000" class="form-control" rows="5" id="inputDescription" ng-attr-placeholder="{{ 'document.edit.description_placeholder' | translate }}"
            name="description" ng-model="document.description" ng-disabled="fileIsUploading"></textarea>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" for="inputCreateDate">{{ 'document.creation_date' | translate }}</label>
        <div class="col-sm-10">
          <input type="text" id="inputCreateDate"
                 current-text="{{ 'directive.datepicker.current' | translate }}"
                 clear-text="{{ 'directive.datepicker.clear' | translate }}"
                 close-text="{{ 'directive.datepicker.close' | translate }}"
                 ng-readonly="true" uib-datepicker-popup="{{ dateFormat }}" class="form-control"
                 ng-model="document.create_date" datepicker-options="{ startingDay:1, showWeeks: false }"
                 ng-click="datepickerOpened = true" is-open="datepickerOpened" ng-disabled="fileIsUploading" />
        </div>
      </div>
      <div class="form-group hide">
        <label class="col-sm-2 control-label" for="inputLanguage">{{ 'document.language' | translate }}</label>
        <div class="col-sm-10">
          <select class="form-control" id="inputLanguage" ng-model="document.language" ng-disabled="fileIsUploading">
            <option ng-repeat="language in acceptedLanguages" value="{{ language.key }}">{{ language.label }}</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" for="inputFiles">{{ 'document.edit.new_files' | translate }}</label>
        <div class="col-sm-6">
          <input type="file" ngf-select class="form-control" id="inputFiles" ngf-multiple="true" ng-model="newFiles" ng-disabled="fileIsUploading"></input>
        </div>
        <div class="col-sm-4" ng-if="orphanFiles.length > 0"
             translate="document.edit.orphan_files"
             translate-values="{ count: orphanFiles.length }">
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" for="inputTags">{{ 'document.tags' | translate }}</label>
        <div class="col-sm-10">
          <select-tag tags="document.tags" ref="inputTags" ng-disabled="fileIsUploading"></select-tag>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-2 control-label" for="inputRelations">{{ 'document.relations' | translate }}</label>
        <div class="col-sm-10">
          <select-relation relations="document.relations" ref="inputRelations" ng-disabled="fileIsUploading"></select-relation>
        </div>
      </div>
    </fieldset>

    <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-primary" ng-disabled="!documentForm.$valid || fileIsUploading" ng-click="edit()">
          <span class="fas fa-save"></span>
          {{ 'save' | translate }}
        </button>
        <button type="submit" class="btn btn-default" ng-click="cancel()" ng-disabled="fileIsUploading">{{ 'cancel' | translate }}</button>
      </div>
    </div>
  </form>
</div>